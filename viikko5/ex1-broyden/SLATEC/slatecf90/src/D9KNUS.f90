subroutine D9KNUS (XNU, X, BKNU, BKNU1, ISWTCH)
!
!! D9KNUS computes Bessel functions EXP(X)*K-SUB-XNU(X) and ...
!  EXP(X)*K-SUB-XNU+1(X) for 0.0  <=  XNU  <  1.0.
!
!***LIBRARY   SLATEC (FNLIB)
!***CATEGORY  C10B3
!***TYPE      DOUBLE PRECISION (R9KNUS-S, D9KNUS-D)
!***KEYWORDS  BESSEL FUNCTION, FNLIB, SPECIAL FUNCTIONS
!***AUTHOR  Fullerton, W., (LANL)
!***DESCRIPTION
!
! Compute Bessel functions EXP(X) * K-sub-XNU (X)  and
! EXP(X) * K-sub-XNU+1 (X) for 0.0  <=  XNU  <  1.0 .
!
! Series for C0K        on the interval  0.          to  2.50000E-01
!                                        with weighted error   2.16E-32
!                                         log weighted error  31.67
!                               significant figures required  30.86
!                                    decimal places required  32.40
!
! Series for ZNU1       on the interval -7.00000E-01 to  0.
!                                        with weighted error   2.45E-33
!                                         log weighted error  32.61
!                               significant figures required  31.85
!                                    decimal places required  33.26
!
!***REFERENCES  (NONE)
!***ROUTINES CALLED  D1MACH, DCSEVL, DGAMMA, INITDS, XERMSG
!***REVISION HISTORY  (YYMMDD)
!   770601  DATE WRITTEN
!   890531  Changed all specific intrinsics to generic.  (WRB)
!   890911  Removed unnecessary intrinsics.  (WRB)
!   890911  REVISION DATE from Version 3.2
!   891214  Prologue converted to Version 4.0 format.  (BAB)
!   900315  CALLs to XERROR changed to CALLs to XERMSG.  (THJ)
!   900720  Routine changed from user-callable to subsidiary.  (WRB)
!   900727  Added EXTERNAL statement.  (WRB)
!   920618  Removed space from variable names.  (RWC, WRB)
!***END PROLOGUE  D9KNUS
  DOUBLE PRECISION XNU, X, BKNU, BKNU1, ALPHA(32), BETA(32), A(32), &
    C0KCS(29), ZNU1CS(20), ALNZ, ALN2, A0, BKNUD, BKNU0, &
    B0, C0, EULER, EXPX, P1, P2, P3, QQ, RESULT, SQPI2, SQRTX, V, &
    VLNZ, XI, XMU, XNUSML, XSML, X2N, X2TOV, Z, ZTOV, ALNSML, &
    ALNBIG
  REAL ALNEPS
  DOUBLE PRECISION D1MACH, DCSEVL, DGAMMA
  LOGICAL FIRST
  EXTERNAL DGAMMA
  SAVE C0KCS, ZNU1CS, EULER, SQPI2, ALN2, NTC0K, &
   NTZNU1, XNUSML, XSML, ALNSML, ALNBIG, ALNEPS, FIRST
  DATA C0KCS(  1) / +.60183057242626108387577445180329D-1     /
  DATA C0KCS(  2) / -.15364871433017286092959755943124D+0     /
  DATA C0KCS(  3) / -.11751176008210492040068229226213D-1     /
  DATA C0KCS(  4) / -.85248788891979509827048401550987D-3     /
  DATA C0KCS(  5) / -.61329838767496791874098176922111D-4     /
  DATA C0KCS(  6) / -.44052281245510444562679889548505D-5     /
  DATA C0KCS(  7) / -.31631246728384488192915445892199D-6     /
  DATA C0KCS(  8) / -.22710719382899588330673771793396D-7     /
  DATA C0KCS(  9) / -.16305644608077609552274620515360D-8     /
  DATA C0KCS( 10) / -.11706939299414776568756044043130D-9     /
  DATA C0KCS( 11) / -.84052063786464437174546593413792D-11    /
  DATA C0KCS( 12) / -.60346670118979991487096050737198D-12    /
  DATA C0KCS( 13) / -.43326960335681371952045997366903D-13    /
  DATA C0KCS( 14) / -.31107358030203546214634697772237D-14    /
  DATA C0KCS( 15) / -.22334078226736982254486133409840D-15    /
  DATA C0KCS( 16) / -.16035146716864226300635791528610D-16    /
  DATA C0KCS( 17) / -.11512717363666556196035697705305D-17    /
  DATA C0KCS( 18) / -.82657591746836959105169479089258D-19    /
  DATA C0KCS( 19) / -.59345480806383948172333436695984D-20    /
  DATA C0KCS( 20) / -.42608138196467143926499613023976D-21    /
  DATA C0KCS( 21) / -.30591266864812876299263698370542D-22    /
  DATA C0KCS( 22) / -.21963541426734575224975501815516D-23    /
  DATA C0KCS( 23) / -.15769113261495836071105750684760D-24    /
  DATA C0KCS( 24) / -.11321713935950320948757731048056D-25    /
  DATA C0KCS( 25) / -.81286248834598404082792349714433D-27    /
  DATA C0KCS( 26) / -.58360900893453226552829349315949D-28    /
  DATA C0KCS( 27) / -.41901241623610922519452337780905D-29    /
  DATA C0KCS( 28) / -.30083737960206435069530504212862D-30    /
  DATA C0KCS( 29) / -.21599152067808647728342168089832D-31    /
  DATA ZNU1CS(  1) / +.203306756994191729674444001216911D+0    /
  DATA ZNU1CS(  2) / +.140077933413219771062943670790563D+0    /
  DATA ZNU1CS(  3) / +.791679696100161352840972241972320D-2    /
  DATA ZNU1CS(  4) / +.339801182532104045352930092205750D-3    /
  DATA ZNU1CS(  5) / +.117419756889893366664507228352690D-4    /
  DATA ZNU1CS(  6) / +.339357570612261680333825865475121D-6    /
  DATA ZNU1CS(  7) / +.842594176976219910194629891264803D-8    /
  DATA ZNU1CS(  8) / +.183336677024850089184748150900090D-9    /
  DATA ZNU1CS(  9) / +.354969844704416310863007064469557D-11   /
  DATA ZNU1CS( 10) / +.619032496469887332205244342078407D-13   /
  DATA ZNU1CS( 11) / +.981964535680439424960346115456527D-15   /
  DATA ZNU1CS( 12) / +.142851314396490474211473563005985D-16   /
  DATA ZNU1CS( 13) / +.191894921887825298966162467488436D-18   /
  DATA ZNU1CS( 14) / +.239430979739498914162313140597128D-20   /
  DATA ZNU1CS( 15) / +.278890246815347354835870465474995D-22   /
  DATA ZNU1CS( 16) / +.304606650633033442582845214092865D-24   /
  DATA ZNU1CS( 17) / +.313173237042191815771564260932089D-26   /
  DATA ZNU1CS( 18) / +.304133098987854951645174908005034D-28   /
  DATA ZNU1CS( 19) / +.279840384636833084343185097659733D-30   /
  DATA ZNU1CS( 20) / +.244637186274497596485238794922666D-32   /
  DATA EULER / 0.57721566490153286060651209008240D0 /
  DATA SQPI2 / +1.2533141373155002512078826424055D0      /
  DATA ALN2 / 0.69314718055994530941723212145818D0 /
  DATA FIRST /.TRUE./
!***FIRST EXECUTABLE STATEMENT  D9KNUS
  if (FIRST) THEN
     ETA = 0.1D0*D1MACH(3)
     NTC0K = INITDS (C0KCS, 29, ETA)
     NTZNU1 = INITDS (ZNU1CS, 20, ETA)
!
     XNUSML = SQRT(D1MACH(3)/8.D0)
     XSML = 0.1D0*D1MACH(3)
     ALNSML = LOG (D1MACH(1))
     ALNBIG = LOG (D1MACH(2))
     ALNEPS = LOG (0.1D0*D1MACH(3))
  end if
  FIRST = .FALSE.
!
  if (XNU  <  0.D0 .OR. XNU  >=  1.D0) call XERMSG ('SLATEC', &
     'D9KNUS', 'XNU MUST BE GE 0 AND LT 1', 1, 2)
  if (X  <=  0.) call XERMSG ('SLATEC', 'D9KNUS', 'X MUST BE GT 0', &
     2, 2)
!
  ISWTCH = 0
  if (X > 2.0D0) go to 50
!
! X IS SMALL.  COMPUTE K-SUB-XNU (X) AND THE DERIVATIVE OF K-SUB-XNU (X)
! THEN FIND K-SUB-XNU+1 (X).  XNU IS REDUCED TO THE INTERVAL (-.5,+.5)
! THEN TO (0., .5), BECAUSE K OF NEGATIVE ORDER (-NU) = K OF POSITIVE
! ORDER (+NU).
!
  V = XNU
  if (XNU > 0.5D0) V = 1.0D0 - XNU
!
! CAREFULLY FIND (X/2)**XNU AND Z**XNU WHERE Z = X*X/4.
  ALNZ = 2.D0 * (LOG(X) - ALN2)
!
  if (X > XNU) go to 20
  if (-0.5D0*XNU*ALNZ-ALN2-LOG(XNU)  >  ALNBIG) call XERMSG &
     ('SLATEC', 'D9KNUS', 'X SO SMALL BESSEL K-SUB-XNU OVERFLOWS', &
     3, 2)
!
 20   VLNZ = V*ALNZ
  X2TOV = EXP (0.5D0*VLNZ)
  ZTOV = 0.0D0
  if (VLNZ > ALNSML) ZTOV = X2TOV**2
!
  A0 = 0.5D0*DGAMMA(1.0D0+V)
  B0 = 0.5D0*DGAMMA(1.0D0-V)
  C0 = -EULER
  if (ZTOV > 0.5D0 .AND. V > XNUSML) C0 = -0.75D0 + &
    DCSEVL ((8.0D0*V)*V-1.0D0, C0KCS, NTC0K)
!
  if (ZTOV <= 0.5D0) ALPHA(1) = (A0-ZTOV*B0)/V
  if (ZTOV > 0.5D0) ALPHA(1) = C0 - ALNZ*(0.75D0 + &
    DCSEVL (VLNZ/0.35D0+1.0D0, ZNU1CS, NTZNU1))*B0
  BETA(1) = -0.5D0*(A0+ZTOV*B0)
!
  Z = 0.0D0
  if (X > XSML) Z = 0.25D0*X*X
  NTERMS = MAX (2.0, 11.0+(8.*REAL(ALNZ)-25.19-ALNEPS) &
    /(4.28-REAL(ALNZ)))
  DO 30 I=2,NTERMS
    XI = I - 1
    A0 = A0/(XI*(XI-V))
    B0 = B0/(XI*(XI+V))
    ALPHA(I) = (ALPHA(I-1)+2.0D0*XI*A0)/(XI*(XI+V))
    BETA(I) = (XI-0.5D0*V)*ALPHA(I) - ZTOV*B0
 30   CONTINUE
!
  BKNU = ALPHA(NTERMS)
  BKNUD = BETA(NTERMS)
  DO 40 II=2,NTERMS
    I = NTERMS + 1 - II
    BKNU = ALPHA(I) + BKNU*Z
    BKNUD = BETA(I) + BKNUD*Z
 40   CONTINUE
!
  EXPX = EXP(X)
  BKNU = EXPX*BKNU/X2TOV
!
  if (-0.5D0*(XNU+1.D0)*ALNZ-2.0D0*ALN2 > ALNBIG) ISWTCH = 1
  if (ISWTCH == 1) RETURN
  BKNUD = EXPX*BKNUD*2.0D0/(X2TOV*X)
!
  if (XNU <= 0.5D0) BKNU1 = V*BKNU/X - BKNUD
  if (XNU <= 0.5D0) RETURN
!
  BKNU0 = BKNU
  BKNU = -V*BKNU/X - BKNUD
  BKNU1 = 2.0D0*XNU*BKNU/X + BKNU0
  return
!
! X IS LARGE.  FIND K-SUB-XNU (X) AND K-SUB-XNU+1 (X) WITH Y. L. LUKE-S
! RATIONAL EXPANSION.
!
 50   SQRTX = SQRT(X)
  if (X > 1.0D0/XSML) go to 90
  AN = -0.60 - 1.02/REAL(X)
  BN = -0.27 - 0.53/REAL(X)
  NTERMS = MIN (32, MAX1 (3.0, AN+BN*ALNEPS))
!
  DO 80 INU=1,2
    XMU = 0.D0
    if (INU == 1 .AND. XNU > XNUSML) XMU = (4.0D0*XNU)*XNU
    if (INU == 2) XMU = 4.0D0*(ABS(XNU)+1.D0)**2
!
    A(1) = 1.0D0 - XMU
    A(2) = 9.0D0 - XMU
    A(3) = 25.0D0 - XMU
    if (A(2) == 0.D0) RESULT = SQPI2*(16.D0*X+XMU+7.D0) / &
      (16.D0*X*SQRTX)
    if (A(2) == 0.D0) go to 70
!
    ALPHA(1) = 1.0D0
    ALPHA(2) = (16.D0*X+A(2))/A(2)
    ALPHA(3) = ((768.D0*X+48.D0*A(3))*X + A(2)*A(3))/(A(2)*A(3))
!
    BETA(1) = 1.0D0
    BETA(2) = (16.D0*X+(XMU+7.D0))/A(2)
    BETA(3) = ((768.D0*X+48.D0*(XMU+23.D0))*X + &
      ((XMU+62.D0)*XMU+129.D0))/(A(2)*A(3))
!
    if (NTERMS < 4) go to 65
    DO 60 I=4,NTERMS
      N = I - 1
      X2N = 2*N - 1
!
      A(I) = (X2N+2.D0)**2 - XMU
      QQ = 16.D0*X2N/A(I)
      P1 = -X2N*((12*N*N-20*N)-A(1))/((X2N-2.D0)*A(I)) &
        - QQ*X
      P2 = ((12*N*N-28*N+8)-A(1))/A(I) - QQ*X
      P3 = -X2N*A(I-3)/((X2N-2.D0)*A(I))
!
      ALPHA(I) = -P1*ALPHA(I-1) - P2*ALPHA(I-2) - P3*ALPHA(I-3)
      BETA(I) = -P1*BETA(I-1) - P2*BETA(I-2) - P3*BETA(I-3)
 60     CONTINUE
!
 65     RESULT = SQPI2*BETA(NTERMS)/(SQRTX*ALPHA(NTERMS))
!
 70     if (INU == 1) BKNU = RESULT
    if (INU == 2) BKNU1 = RESULT
 80   CONTINUE
  return
!
 90   BKNU = SQPI2/SQRTX
  BKNU1 = BKNU
  return
!
end
